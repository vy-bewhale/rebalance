# Backtester: Стратегии ребалансировки портфеля [![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](<Your App URL - Replace this>) <!-- Замените на URL вашего развернутого приложения -->

Интерактивное веб-приложение на Streamlit для детального бэктестинга и сравнения различных стратегий ребалансировки инвестиционного портфеля.

<!-- Добавьте скриншот сюда -->
<!-- ![Скриншот приложения](link_to_your_screenshot.png) -->

## Описание

Данный инструмент позволяет пользователям моделировать поведение инвестиционных портфелей с течением времени, применяя различные правила ребалансировки. Цель - помочь понять, как разные подходы к управлению портфелем влияют на его доходность, риск и другие ключевые метрики.

## Основные возможности

*   **Гибкий выбор активов:** Добавление/удаление активов из предустановленного списка популярных ETF, охватывающих различные классы: акции США (крупные, технологические, малые компании), акции развитых и развивающихся рынков, казначейские и корпоративные облигации США, международные облигации, золото, недвижимость, сырье, криптовалюты (Bitcoin) и основные валюты (Euro, Yen, Pound).
*   **Настройка целевого портфеля:** Интуитивное задание целевых весов для каждого выбранного актива и доли денежных средств (Cash).
*   **Выбор периода анализа:** Установка начальной и конечной даты для проведения бэктестинга.
*   **Сравнение стратегий ребалансировки:**
    *   **Календарная:** Классическая ребалансировка к целевым весам с фиксированной частотой (ежемесячно, ежеквартально, ежегодно в конце периода).
    *   **По порогу цены %:** Ребалансировка происходит, когда цена *любого* актива в портфеле отклоняется на заданный процент (вверх или вниз) от его цены на момент **последней ребалансировки, инициированной именно ценовым триггером**. Календарные ребалансировки не сбрасывают базовую цену для этого триггера.
    *   **Комбинированная:** Ребалансировка происходит при наступлении **любого** из следующих событий: наступила плановая дата календарной ребалансировки **ИЛИ** сработал триггер по порогу цены (логика порога цены аналогична стратегии "По порогу цены %"). Базовая цена для процентного триггера сбрасывается только после ребалансировки, вызванной (или также вызванной) ценовым триггером.
*   **Сравнение с базовыми стратегиями Buy & Hold (B&H):**
    *   **B&H (Целевые веса):** Моделирует результат портфеля, сформированного в соответствии с целевыми весами в начальный момент и удерживаемого без дальнейших ребалансировок.
    *   **B&H (Отдельные активы):** Показывает результат 100% инвестиции в каждый из выбранных активов по отдельности.
*   **Интерактивная визуализация:**
    *   График нормализованных цен выбранных активов для оценки их индивидуальной динамики.
    *   График динамики стоимости портфеля для всех сравниваемых стратегий (с возможностью использования логарифмической шкалы для лучшего восприятия долгосрочных трендов).
    *   График динамики просадок для основных стратегий ребалансировки и B&H (Целевые веса).
*   **Расчет и отображение метрик эффективности:** Подробная таблица с ключевыми показателями для каждой стратегии:
    *   Конечная стоимость
    *   CAGR (Среднегодовая доходность)
    *   Максимальная просадка (%)
    *   Волатильность (среднегодовое стандартное отклонение доходности)
    *   Коэффициент Шарпа
    *   Коэффициент Сортино
    *   Фактор восстановления (отношение общей прибыли к максимальной абсолютной просадке)

## Предварительные требования

Перед установкой убедитесь, что у вас установлены:

*   **Python:** Версия 3.8 или выше.
*   **Git:** Для клонирования репозитория.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    # Замените <URL репозитория> на актуальный URL, если он есть
    # git clone <URL репозитория>
    # cd <папка репозитория>
    # Если вы уже в папке проекта, пропустите этот шаг
    ```
2.  **Создайте и активируйте виртуальное окружение** (рекомендуется):
    ```bash
    # Windows
    python -m venv .venv
    .\.venv\Scripts\activate

    # macOS / Linux
    python3 -m venv .venv
    source .venv/bin/activate
    ```
3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

## Запуск приложения

1.  Убедитесь, что ваше виртуальное окружение активировано (в терминале должна быть приписка типа `(.venv)`).
2.  Выполните команду:
    ```bash
    streamlit run app.py
    ```
3.  Приложение автоматически откроется в вашем веб-браузере. Если нет, перейдите по одному из URL, указанных в терминале (обычно `http://localhost:8501`).

## Как использовать

1.  **Настройте параметры в боковой панели слева:**
    *   Выберите интересующие вас активы из списка.
    *   Установите начальную и конечную даты для анализа.
    *   Выберите частоту для *календарной* ребалансировки.
    *   Установите порог в % для *ценовой* ребалансировки.
    *   Задайте годовую безрисковую ставку для расчета коэф. Шарпа и Сортино.
    *   Установите целевые веса для выбранных активов и кэша. Убедитесь, что сумма весов равна 100%.
2.  **Нажмите кнопку "Запустить Бэктест".**
3.  **Анализируйте результаты:** Изучите графики и таблицу с метриками в основной области приложения.

## Структура проекта

```
.
├── .gitignore         # Файл для Git, указывающий, какие файлы игнорировать
├── app.py             # Основной файл приложения Streamlit (UI)
├── core.py            # Ядро: загрузка данных, логика бэктестинга, расчет метрик
├── plots.py           # Функции для генерации графиков (Plotly)
├── README.md          # Эта документация
├── requirements.txt   # Список зависимостей Python
└── .venv/             # Папка виртуального окружения (если создано)
```

## Ограничения и известные проблемы

*   **Качество данных:** Исторические данные загружаются с Yahoo Finance. Возможны пропуски, неточности или временная недоступность данных для некоторых тикеров.
*   **Допущения модели:** Бэктест не учитывает комиссии брокера, налоги, проскальзывания при исполнении ордеров и другие транзакционные издержки, что может привести к завышению результатов по сравнению с реальной торговлей.
*   **Выживаемость активов:** Бэктест не учитывает риск делистинга активов (ETF).
*   **Криптовалюты:** Данные по криптовалютам могут быть доступны за более короткий период, чем по традиционным активам.

## Лицензия

<!-- Укажите здесь вашу лицензию, например: -->
Распространяется под лицензией MIT. Смотрите `LICENSE` для получения дополнительной информации (если файл лицензии существует).

## Возможные улучшения

*   Добавление учета комиссий.
*   Возможность загрузки пользовательских данных.
*   Расширение списка доступных активов.
*   Добавление других стратегий ребалансировки (например, по коридорам долей).
*   Более продвинутый анализ рисков. 